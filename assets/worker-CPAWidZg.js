(function(){"use strict";const w={generate:t=>{const e=[],a=Math.floor(Math.random()*10)+10,n=Math.min(t.windowWidth,t.windowHeight)/1e3,o=130*n,s=65*n;for(let h=0;h<a;h++)e.push({x:(Math.random()*120-60)*n,y:(Math.random()*60-30)*n,width:Math.random()*o+40*n,height:Math.random()*s+40*n});const r=t.windowHeight*.4*.8;return{x:t.windowWidth+t.spawnOffset,y:Math.random()*r,sections:e}},update:(t,e)=>{const a=t.map(n=>({...n,x:n.x-e.cloudSpeed})).filter(n=>n.x>-e.spawnOffset);return a.length<e.maxClouds&&Math.random()<e.cloudSpawnChance&&a.push(w.generate(e)),a},initialize:t=>{const e=[];for(let a=0;a<t.maxClouds;a++){const n=w.generate(t);n.x=Math.random()*t.windowWidth,e.push(n)}return e}},x={generate:t=>{const e=[],a=t.windowHeight,n=t.chunkWidth;for(let o=0;o<t.starsPerChunk;o++){const s=Math.random()*n,d=Math.random()*Math.random()*a*.9,r=(Math.random()*1+.5)*(Math.min(t.windowWidth,t.windowHeight)/1e3);e.push(`M ${s} ${d} a ${r} ${r} 0 1 0 ${r*2} 0 a ${r} ${r} 0 1 0 -${r*2} 0`)}return{id:crypto.randomUUID(),x:t.startX,pathData:e.join(" ")}},update:(t,e)=>t,initialize:t=>{const e=[],a=Math.ceil(t.windowWidth/t.chunkWidth)+2;for(let n=0;n<a;n++)e.push(x.generate({...t,startX:n*t.chunkWidth}));return e}},$=Date.now()%1e3/1e3*100,g=t=>{const e=t+$;return(Math.sin(e)*.5+Math.sin(e*2.1)*.25+Math.sin(e*4.3)*.125+Math.sin(e*8.7)*.0625)*.5+.5},k=(t,e)=>{const{windowWidth:a,windowHeight:n,chunkSize:o}=t,s=o,d=o+s,r=Math.max(50,Math.ceil(d/10)),h=[];for(let c=0;c<=r;c++){const u=c*d/r-s/2,l=e+u,m=g((t.time+l)*t.noiseScale),M=n*(t.minGroundHeight+m*(t.maxGroundHeight-t.minGroundHeight));h.push({x:u,height:M})}let i=`M ${-s/2} ${n} `;i+=`L ${-s/2} ${n-h[0].height} `;for(let c=1;c<h.length;c++){const u=h[c-1],l=h[c],m=(u.x+l.x)/2,M=n-(u.height+l.height)/2;i+=`Q ${u.x} ${n-u.height} ${m} ${M} `}return i+=`L ${o+s/2} ${n-h[h.length-1].height} `,i+=`L ${o+s/2} ${n} Z`,i},p={generate:t=>{const a=Math.max(.5,Math.min(1.2,t.windowWidth/1920)),n=t.chunkSize/4;return{id:crypto.randomUUID(),x:t.startX-n*(2-a),pathData:k(t,t.startX)}},update:(t,e)=>{const n=Math.max(.5,Math.min(1.2,e.windowWidth/1920)),o=e.chunkSize/4,s=e.chunkSize*n,d=-(e.chunkSize+o),r=t.map(i=>({...i,x:i.x-e.groundSpeed})).filter(i=>i.x>d),h=r[r.length-1];if(!h||h.x+s<e.windowWidth){const i=h?h.x+s:0;r.push(p.generate({...e,startX:i}))}return r},initialize:t=>{const a=Math.max(.5,Math.min(1.2,t.windowWidth/1920)),n=t.chunkSize*a,o=Math.ceil(t.windowWidth/n)+2,s=[];for(let d=0;d<o;d++){const r=d*n;s.push(p.generate({...t,startX:r}))}return s}},W={generate:t=>({id:crypto.randomUUID(),x:Math.random()*t.windowWidth,y:Math.random()*t.windowHeight,diameter:Math.random()*2+1,fadingFactor:Math.random()}),update:(t,e)=>t.map(a=>({...a,fadingFactor:(Math.sin(Date.now()*.001+a.x)+1)/2})),initialize:t=>{const e=[];for(let a=0;a<t.maxStars;a++)e.push(W.generate(t));return e}},y={CLOUD:w,STAR:W,STAR_CHUNK:x,TERRAIN:p},H=async t=>{const e=y[t.entityType],{entities:a,config:n}=t.payload;switch(t.action){case"GENERATE":return e.generate(n);case"UPDATE":return e.update(a||[],n);case"INITIALIZE":return e.initialize(n);default:throw new Error(`Unknown action: ${t.action}`)}};self.onmessage=async t=>{const{taskId:e,entityType:a,action:n,payload:o}=t.data;try{const s=await H({entityType:a,action:n,payload:o});self.postMessage({taskId:e,result:s})}catch(s){self.postMessage({taskId:e,error:s instanceof Error?s.message:"Unknown error"})}}})();
